name: "ğŸ‰ Velog â†’ Jekyll Auto Sync"

on:
    workflow_dispatch:
    schedule:
        - cron: "0 */6 * * *" # 6ì‹œê°„ë§ˆë‹¤ ìë™ ì‹¤í–‰

jobs:
    sync:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                  python-version: "3.11"

            - name: Install dependencies
              run: pip install feedparser requests beautifulsoup4

            - name: Wait for Velog RSS to update
              run: sleep 180 # RSS ê°±ì‹  ëŒ€ê¸° (3ë¶„)

            - name: Run Velog sync script
              run: python velog_to_jekyll_images.py

            - name: Commit & Push changes
              run: |
                  git config user.name "Velog Sync Bot"
                  git config user.email "actions@github.com"
                  git add .
                  git commit -m "ğŸª„ Auto-sync Velog posts" || echo "No changes"
                  git push

            - name: Send Discord notification
              if: success()
              env:
                  DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
              run: |
                  LATEST_POST=$(ls -t _posts | head -n 1)
                  MESSAGE="ğŸ“° ìƒˆë¡œìš´ í¬ìŠ¤íŠ¸ê°€ ìë™ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\nğŸ‘‰ $LATEST_POST"
                  curl -H "Content-Type: application/json" \
                       -d "{\"content\": \"$MESSAGE\"}" \
                       $DISCORD_WEBHOOK_URL
